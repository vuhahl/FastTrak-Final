<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="FastTrak.Views.CustomizationPage"
             xmlns:models="clr-namespace:FastTrak.Models"
             Title="CustomizationPage">
    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="24">

            <!-- Item Name -->
            <Label Text="{Binding ItemName}"
                   FontSize="26"
                   FontAttributes="Bold"
                   TextColor="{StaticResource TextPrimaryColor}" />

            <!-- Quantity Selector -->
            <Frame BackgroundColor="{StaticResource SurfaceColor}"
                   CornerRadius="14"
                   Padding="16">

                <HorizontalStackLayout Spacing="20"
                                       HorizontalOptions="Center">

                    <Button Text="-"
                            WidthRequest="50"
                            Command="{Binding DecreaseQuantityCommand}" />

                    <Label Text="{Binding Quantity}"
                           FontSize="20"
                           VerticalOptions="Center"
                           HorizontalOptions="Center" />

                    <Button Text="+" 
                            WidthRequest="50"
                            Command="{Binding IncreaseQuantityCommand}" />

                </HorizontalStackLayout>
            </Frame>

            <!-- Base Nutrition -->
            <Frame BackgroundColor="{StaticResource SurfaceColor}"
                   CornerRadius="14"
                   Padding="16">

                <VerticalStackLayout>
                    <Label Text="Nutrition (Base)"
                           FontAttributes="Bold"
                           FontSize="18" />

                    <Label Text="{Binding BaseNutritionText}"
                           FontSize="14"
                           TextColor="{StaticResource TextSecondaryColor}" />
                </VerticalStackLayout>

            </Frame>

            <!-- Custom Option Groups -->
            <CollectionView ItemsSource="{Binding OptionGroups}"
                            SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:OptionGroup">

                        <Frame BackgroundColor="{StaticResource SurfaceColor}"
                               CornerRadius="14"
                               Padding="16"
                               Margin="0,10">

                            <VerticalStackLayout Spacing="10">

                                <Label Text="{Binding Category}"
                                       FontSize="20"
                                       FontAttributes="Bold" />

                                <!-- Options within group -->
                                <CollectionView ItemsSource="{Binding Options}">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="models:SelectableOption">

                                            <Frame BackgroundColor="{StaticResource BackgroundColor}"
                                                   CornerRadius="8"
                                                   Padding="8"
                                                   Margin="0,6">

                                                <HorizontalStackLayout Spacing="12">
                                                    <CheckBox IsChecked="{Binding IsSelected}"
                                                              Color="{StaticResource PrimaryColor}" />

                                                    <VerticalStackLayout>
                                                        <Label Text="{Binding Name}"
                                                               FontSize="16" />

                                                        <Label Text="{Binding NutritionSummary}"
                                                               FontSize="12"
                                                               TextColor="{StaticResource TextSecondaryColor}" />
                                                    </VerticalStackLayout>
                                                </HorizontalStackLayout>

                                            </Frame>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>

                            </VerticalStackLayout>
                        </Frame>

                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- LIVE TOTAL NUTRITION -->
            <Frame BackgroundColor="{StaticResource SurfaceColor}"
       CornerRadius="14"
       Padding="16">

                <VerticalStackLayout Spacing="6">
                    <Label Text="Total Nutrition"
               FontSize="20"
               FontAttributes="Bold" />

                    <Label Text="{Binding TotalNutritionText}"
               FontSize="14"
               TextColor="{StaticResource TextSecondaryColor}" />
                </VerticalStackLayout>

            </Frame>

            <!-- Add Button -->
            <Button Text="Add to Log"
                    FontSize="20"
                    BackgroundColor="{StaticResource PrimaryColor}"
                    TextColor="White"
                    CornerRadius="10"
                    Command="{Binding AddToLogCommand}" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>